<!DOCTYPE html>
<html>

<head>
  <title> {{title}} </title>
  <link rel='stylesheet' href='/stylesheets/style.css' />
</head>

<body>
  <h1> {{title}} </h1>
  <p>Welcome to {{title}} </p>
  <label for="initDate">From:</label>
  <input type="date" name="initDate" id="initDate">
  <label for="endDate">to:</label>
  <input type="date" name="endDate" id="endDate">
  <label for="currency">Currency</label>
  <select name="currency" id="currency">
    <option value="USD">US Dollar $</option>
    <option value="EUR">EURO â‚¬</option>
  </select>
  <p id="max"></p>
  <p id="min"></p>


  <canvas id="myCanvas" width="200px" height="150px"></canvas>
</body>
<script src="/javascripts/financial-data.js" charset="utf-8"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.4.0/Chart.min.js"></script>
<script src="https://unpkg.com/axios/dist/axios.min.js"></script>
<script src="https://code.jquery.com/jquery-3.3.1.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
  crossorigin="anonymous"></script>
<script>
  const ctx = document.querySelector("#myCanvas").getContext("2d")
  const initDate = document.querySelector("#initDate")
  const endDate = document.querySelector("#endDate")
  const currency = document.querySelector("#currency")
  let today = new Date()
  let monthAgo = new Date()
  monthAgo.setMonth(monthAgo.getMonth() - 1)
  initDate.value = monthAgo.toISOString().split('T')[0]
  endDate.value = today.toISOString().split('T')[0]

  $("#initDate, #endDate, #currency").change(() => {
    paintChart()
  })
  const paintChart = (arg) => {
    axios
      .get(`https://api.coindesk.com/v1/bpi/historical/close.json?currency=${currency.value}&start=${initDate.value}&end=${endDate.value}`)
      .then(json => {
        const max = document.querySelector("#max").innerHTML = "MAX: " + Math.max.apply(Math, Object.values(json.data.bpi))
        const min = document.querySelector("#min").innerHTML = "MIN: " + Math.min.apply(Math, Object.values(json.data.bpi))
        let myChart = new Chart(ctx, {
          type: "line",
          data: {
            labels: Object.keys(json.data.bpi),
            datasets: [{
              label: "Bitcoin Price Index",
              data: Object.values(json.data.bpi)
            }]
          }
        })
      })
      .catch(err => console.log("An error ocurred: ", err))
  }
  paintChart()

</script>

</html>